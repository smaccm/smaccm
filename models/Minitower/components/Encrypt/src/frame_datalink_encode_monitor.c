/* This file has been autogenerated by Ivory
 * Compiler version  0.1.0.4
 */
#include "frame_datalink_encode_monitor.h"

int32_t datalink_encode_ringbuffer_insert = (int32_t) 0 % 4;

int32_t datalink_encode_ringbuffer_remove = (int32_t) 0 % 4;

uint8_t datalink_encode_ringbuffer_buf[4U][96U];

bool pending;

void callback_encoder_ct_push(const uint8_t n_var0[96U])
{
    bool n_r0 = datalink_encode_ringbuffer_push(n_var0);
}

void callback_periodic_encoder_ct_pop(const int64_t *n_var0)
{
    bool n_deref0 = pending;
    
    if ((bool) !n_deref0) {
        uint8_t n_local1[96U] = {};
        uint8_t *n_ref2 = n_local1;
        bool n_r3 = datalink_encode_ringbuffer_pop(n_ref2);
        
        if (n_r3) {
            callback_encoder_ct_output(n_ref2);
        }
    }
}

void callback_encoder_ct_output(const uint8_t n_var0[96U])
{
    uint8_t n_local0[96U] = {};
    uint8_t *n_ref1 = n_local0;
    
    for (int32_t n_ix2 = (int32_t) 0; n_ix2 <= (int32_t) 95; n_ix2++) {
        ivory_serialize_pack_uint8_be((uint8_t *) n_ref1, (uint32_t) n_ix2, &n_var0[n_ix2]);
    }
    
    struct ivory_string_HXCyphertext n_local3 = {};
    struct ivory_string_HXCyphertext *n_ref4 = &n_local3;
    const int32_t *n_cse13 = &n_ref4->ivory_string_HXCyphertext_len;
    int32_t n_deref5 = *n_cse13;
    int32_t n_deref6 = *n_cse13;
    
    ASSERTS((bool) (n_deref6 < (int32_t) 195));
    
    uint8_t *n_cse22 = n_ref4->ivory_string_HXCyphertext_data;
    
    n_cse22[n_deref6 % 195] = (uint8_t) 126U;
    
    int32_t *n_cse25 = &n_ref4->ivory_string_HXCyphertext_len;
    
    *n_cse25 = (int32_t) ((int32_t) 1 + n_deref6);
    
    int32_t n_deref7 = *n_cse13;
    
    ASSERTS((bool) (n_deref7 < (int32_t) 195));
    n_cse22[n_deref7 % 195] = (uint8_t) 0U;
    *n_cse25 = (int32_t) ((int32_t) 1 + n_deref7);
    for (int32_t n_ix8 = (int32_t) 0; n_ix8 <= (int32_t) 95; n_ix8++) {
        uint8_t n_deref9 = n_ref1[n_ix8];
        
        if ((bool) ((bool) ((uint8_t) 126U == n_deref9) || (bool) (n_deref9 == (uint8_t) 124U))) {
            int32_t n_deref10 = *n_cse13;
            
            ASSERTS((bool) (n_deref10 < (int32_t) 195));
            n_cse22[n_deref10 % 195] = (uint8_t) 124U;
            *n_cse25 = (int32_t) ((int32_t) 1 + n_deref10);
            
            int32_t n_deref11 = *n_cse13;
            
            ASSERTS((bool) (n_deref11 < (int32_t) 195));
            n_cse22[n_deref11 % 195] = (uint8_t) (n_deref9 ^ (uint8_t) 32U);
            *n_cse25 = (int32_t) ((int32_t) 1 + n_deref11);
        } else {
            int32_t n_deref12 = *n_cse13;
            
            ASSERTS((bool) (n_deref12 < (int32_t) 195));
            n_cse22[n_deref12 % 195] = n_deref9;
            *n_cse25 = (int32_t) ((int32_t) 1 + n_deref12);
        }
    }
    
    int32_t n_deref13 = *n_cse13;
    
    ASSERTS((bool) (n_deref13 < (int32_t) 195));
    n_cse22[n_deref13 % 195] = (uint8_t) 126U;
    *n_cse25 = (int32_t) ((int32_t) 1 + n_deref13);
    callback_send_translate(n_ref4);
    pending = true;
}

void callback_complete(const bool *n_var0)
{
    pending = false;
}

bool datalink_encode_ringbuffer_push(const uint8_t n_var0[96U])
{
    int32_t n_deref0 = datalink_encode_ringbuffer_insert;
    int32_t n_local1 = (int32_t) 0;
    int32_t *n_ref2 = &n_local1;
    
    if ((bool) (n_deref0 == (int32_t) 3)) {
        *n_ref2 = (int32_t) 0;
    } else {
        *n_ref2 = (int32_t) (n_deref0 + (int32_t) 1) % 4;
    }
    
    int32_t n_deref3 = *n_ref2;
    int32_t n_deref4 = datalink_encode_ringbuffer_remove;
    
    if ((bool) (n_deref3 == n_deref4)) {
        return false;
    } else {
        int32_t n_deref5 = datalink_encode_ringbuffer_insert;
        
        if (datalink_encode_ringbuffer_buf[n_deref5] != n_var0)
            memcpy(datalink_encode_ringbuffer_buf[n_deref5], n_var0, sizeof(uint8_t [96U]));
        else
            COMPILER_ASSERTS(false);
        
        int32_t n_deref6 = datalink_encode_ringbuffer_insert;
        int32_t n_local7 = (int32_t) 0;
        int32_t *n_ref8 = &n_local7;
        
        if ((bool) ((int32_t) 3 == n_deref6)) {
            *n_ref8 = (int32_t) 0;
        } else {
            *n_ref8 = (int32_t) ((int32_t) 1 + n_deref6) % 4;
        }
        
        int32_t n_deref9 = *n_ref8;
        
        datalink_encode_ringbuffer_insert = n_deref9;
        return true;
    }
}

bool datalink_encode_ringbuffer_pop(uint8_t n_var0[96U])
{
    int32_t n_deref0 = datalink_encode_ringbuffer_insert;
    int32_t n_deref1 = datalink_encode_ringbuffer_remove;
    
    if ((bool) (n_deref0 == n_deref1)) {
        return false;
    } else {
        int32_t n_deref2 = datalink_encode_ringbuffer_remove;
        
        if (n_var0 != datalink_encode_ringbuffer_buf[n_deref2])
            memcpy(n_var0, datalink_encode_ringbuffer_buf[n_deref2], sizeof(uint8_t [96U]));
        else
            COMPILER_ASSERTS(false);
        
        int32_t n_deref3 = datalink_encode_ringbuffer_remove;
        int32_t n_local4 = (int32_t) 0;
        int32_t *n_ref5 = &n_local4;
        
        if ((bool) (n_deref3 == (int32_t) 3)) {
            *n_ref5 = (int32_t) 0;
        } else {
            *n_ref5 = (int32_t) (n_deref3 + (int32_t) 1) % 4;
        }
        
        int32_t n_deref6 = *n_ref5;
        
        datalink_encode_ringbuffer_remove = n_deref6;
        return true;
    }
}
